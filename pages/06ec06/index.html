<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>miasm 使用笔记 | Lingze&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ctfer">
    <meta name="keywords" content="ctfer">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.415d0a97.css" as="style"><link rel="preload" href="/assets/js/app.01f8cc77.js" as="script"><link rel="preload" href="/assets/js/2.5ece5099.js" as="script"><link rel="preload" href="/assets/js/19.2d69c943.js" as="script"><link rel="prefetch" href="/assets/js/10.f923d8b8.js"><link rel="prefetch" href="/assets/js/100.cf64d3e9.js"><link rel="prefetch" href="/assets/js/11.19955ff8.js"><link rel="prefetch" href="/assets/js/12.e16d4c4d.js"><link rel="prefetch" href="/assets/js/13.0552f541.js"><link rel="prefetch" href="/assets/js/14.78d67d73.js"><link rel="prefetch" href="/assets/js/15.d342dfc4.js"><link rel="prefetch" href="/assets/js/16.36f247d6.js"><link rel="prefetch" href="/assets/js/17.031ae63f.js"><link rel="prefetch" href="/assets/js/18.7c49a89e.js"><link rel="prefetch" href="/assets/js/20.e845eb34.js"><link rel="prefetch" href="/assets/js/21.e398898d.js"><link rel="prefetch" href="/assets/js/22.6efd51e5.js"><link rel="prefetch" href="/assets/js/23.21d2b263.js"><link rel="prefetch" href="/assets/js/24.3231fe48.js"><link rel="prefetch" href="/assets/js/25.26e66a19.js"><link rel="prefetch" href="/assets/js/26.ddde99c2.js"><link rel="prefetch" href="/assets/js/27.f8e523dc.js"><link rel="prefetch" href="/assets/js/28.2c1ddb1d.js"><link rel="prefetch" href="/assets/js/29.f15cca3e.js"><link rel="prefetch" href="/assets/js/3.c087139c.js"><link rel="prefetch" href="/assets/js/30.2d433b5b.js"><link rel="prefetch" href="/assets/js/31.87dbaed0.js"><link rel="prefetch" href="/assets/js/32.045dc002.js"><link rel="prefetch" href="/assets/js/33.db01bde8.js"><link rel="prefetch" href="/assets/js/34.d177d280.js"><link rel="prefetch" href="/assets/js/35.360c2104.js"><link rel="prefetch" href="/assets/js/36.afbabc8a.js"><link rel="prefetch" href="/assets/js/37.8e60e299.js"><link rel="prefetch" href="/assets/js/38.c6a43a23.js"><link rel="prefetch" href="/assets/js/39.08102dc6.js"><link rel="prefetch" href="/assets/js/4.28fb810e.js"><link rel="prefetch" href="/assets/js/40.5767c7d7.js"><link rel="prefetch" href="/assets/js/41.307bcf10.js"><link rel="prefetch" href="/assets/js/42.daf03989.js"><link rel="prefetch" href="/assets/js/43.952d68dc.js"><link rel="prefetch" href="/assets/js/44.cbeef42b.js"><link rel="prefetch" href="/assets/js/45.fbd2a9f2.js"><link rel="prefetch" href="/assets/js/46.a92ae456.js"><link rel="prefetch" href="/assets/js/47.24f82953.js"><link rel="prefetch" href="/assets/js/48.fa3498f4.js"><link rel="prefetch" href="/assets/js/49.a64774f2.js"><link rel="prefetch" href="/assets/js/5.0660e0b3.js"><link rel="prefetch" href="/assets/js/50.d0ed88cd.js"><link rel="prefetch" href="/assets/js/51.50727b96.js"><link rel="prefetch" href="/assets/js/52.2756affe.js"><link rel="prefetch" href="/assets/js/53.2739f473.js"><link rel="prefetch" href="/assets/js/54.f0b71120.js"><link rel="prefetch" href="/assets/js/55.94d5a5ee.js"><link rel="prefetch" href="/assets/js/56.637c3b4a.js"><link rel="prefetch" href="/assets/js/57.7b7e3fee.js"><link rel="prefetch" href="/assets/js/58.812bae5d.js"><link rel="prefetch" href="/assets/js/59.70fe1d63.js"><link rel="prefetch" href="/assets/js/6.c52e1544.js"><link rel="prefetch" href="/assets/js/60.0e6a01d3.js"><link rel="prefetch" href="/assets/js/61.702e5198.js"><link rel="prefetch" href="/assets/js/62.38f55e44.js"><link rel="prefetch" href="/assets/js/63.b505c9de.js"><link rel="prefetch" href="/assets/js/64.5489c9d8.js"><link rel="prefetch" href="/assets/js/65.3db6e034.js"><link rel="prefetch" href="/assets/js/66.3605a461.js"><link rel="prefetch" href="/assets/js/67.00d97ed9.js"><link rel="prefetch" href="/assets/js/68.78ef741a.js"><link rel="prefetch" href="/assets/js/69.808ca1f4.js"><link rel="prefetch" href="/assets/js/7.9920c8ea.js"><link rel="prefetch" href="/assets/js/70.15347f58.js"><link rel="prefetch" href="/assets/js/71.b9acfd65.js"><link rel="prefetch" href="/assets/js/72.7e1140f3.js"><link rel="prefetch" href="/assets/js/73.874f0e99.js"><link rel="prefetch" href="/assets/js/74.117bb7d4.js"><link rel="prefetch" href="/assets/js/75.964e2dfe.js"><link rel="prefetch" href="/assets/js/76.2df26afd.js"><link rel="prefetch" href="/assets/js/77.93ebe7b7.js"><link rel="prefetch" href="/assets/js/78.67c6c9bb.js"><link rel="prefetch" href="/assets/js/79.0d846438.js"><link rel="prefetch" href="/assets/js/8.f3c32733.js"><link rel="prefetch" href="/assets/js/80.4716a5b6.js"><link rel="prefetch" href="/assets/js/81.d8c3b2d2.js"><link rel="prefetch" href="/assets/js/82.ea63e06a.js"><link rel="prefetch" href="/assets/js/83.4d1ef8ae.js"><link rel="prefetch" href="/assets/js/84.32a22fe7.js"><link rel="prefetch" href="/assets/js/85.7fb3f862.js"><link rel="prefetch" href="/assets/js/86.4d386fc9.js"><link rel="prefetch" href="/assets/js/87.a095878a.js"><link rel="prefetch" href="/assets/js/88.69d77356.js"><link rel="prefetch" href="/assets/js/89.21ebadb4.js"><link rel="prefetch" href="/assets/js/9.d8b27656.js"><link rel="prefetch" href="/assets/js/90.d49929b7.js"><link rel="prefetch" href="/assets/js/91.cc956227.js"><link rel="prefetch" href="/assets/js/92.b72e3535.js"><link rel="prefetch" href="/assets/js/93.a76f52a2.js"><link rel="prefetch" href="/assets/js/94.82a77dbd.js"><link rel="prefetch" href="/assets/js/95.b0cec47e.js"><link rel="prefetch" href="/assets/js/96.87307703.js"><link rel="prefetch" href="/assets/js/97.c731aa62.js"><link rel="prefetch" href="/assets/js/98.1e36c988.js"><link rel="prefetch" href="/assets/js/99.914f1e07.js">
    <link rel="stylesheet" href="/assets/css/0.styles.415d0a97.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="Lingze's blog" class="logo"> <span class="site-name can-hide">Lingze's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/archives/" class="nav-link">timeline</a></div><div class="nav-item"><a href="/about.html" class="nav-link">about</a></div><div class="nav-item"><a href="/friends.html" class="nav-link">friends</a></div><div class="nav-item"><a href="/categories/" class="nav-link">categories</a></div><div class="nav-item"><a href="/tags/" class="nav-link">tags</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar2.jpg"> <div class="blogger-info"><h3>lingze</h3> <span>bin不是垃圾桶的意思!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/archives/" class="nav-link">timeline</a></div><div class="nav-item"><a href="/about.html" class="nav-link">about</a></div><div class="nav-item"><a href="/friends.html" class="nav-link">friends</a></div><div class="nav-item"><a href="/categories/" class="nav-link">categories</a></div><div class="nav-item"><a href="/tags/" class="nav-link">tags</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=book" title="分类" data-v-1baff76c>book</a></li><li data-v-1baff76c><a href="/categories/?category=reverse" title="分类" data-v-1baff76c>reverse</a></li><li data-v-1baff76c><a href="/categories/?category=vm%E5%92%8C%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C" title="分类" data-v-1baff76c>vm和符号执行</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/wlingze" target="_blank" title="作者" class="beLink" data-v-1baff76c>lingze</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2020-07-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">miasm 使用笔记<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="miasm"><a href="#miasm" class="header-anchor">#</a> miasm</h2> <p>最开始接触到是在fcsc的keykoolol题目wp中， 使用miasm处理一个vm， 同时脚本中并没有出现对于255个opcode对应的设置，但是却像一个反汇编器一样直接打印出类汇编代码，似乎挺神奇， 而后在tigress挑战中的challenge0也在其官方blog有对应wp， 于是开始学习，</p> <p>这个框架目前似乎还没有很完备的资料， 官方的blog简介了使用方向， 但是因为版本更新有些脚本甚至出现了问题，</p> <p>翻到了一个这个， <a href="https://miasmdoc.ajax.re/doxygen/html/namespacemiasm2.html" target="_blank" rel="noopener noreferrer">miasm - api<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>但是比较老，这个框架更新还是比较频繁， 另外就是对照<a href="https://github.com/cea-sec/miasm" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的注释进行学习， 注释倒是比较多， 而且代码质量感觉也比较不错。</p> <blockquote><p>这个框架的学习过程中对于源码的翻看更多了些， 没有一些相关资料， 使用起来的一些报错， 通过直接查找源码中的注释和回显信息等进行解决。</p></blockquote> <p>首先应该比较不同的是这个动态符号执行技术， 即混合使用符号执行和普通的输入确定值的调试，</p> <p>主要思路大致是，因为符号执行会容易造成路径爆炸的问题， 于是提出， 先模拟程序的正常执行， 然后只在关键需要的位置插入符号并在另一端的对应位置取出， 由此通过输入的确定值使得运行过程是固定的， 不会有路径爆炸的情况，而同时使用符号记录运算处理过程， 标记路径， 并自动的通过内置的ir转化为类汇编的语言。</p> <blockquote><p>因此， 这个脚本写起来， 有点像ida python动调的脚本。</p></blockquote> <h2 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h2> <p>首先是要保证程序在框架给出的环境内可以正常运行， 要达到的效果是， 运行脚本并指定对应程序， 除了miasm框架对应的提示信息，输入输出运算判断应该是和直接运行程序无二。</p> <h3 id="sandbox"><a href="#sandbox" class="header-anchor">#</a> sandbox</h3> <p>首先是一个运行环境的设置，miasm 中使用sandbox的概念，，miasm在<code>/miasm/analysis/sandbox.py</code>预设好了以下几个sandbox：</p> <details class="custom-block details"><summary>details</summary> <ul><li>对于linux系统：
<ul><li>aarch64l</li> <li>armb_str</li> <li>arml_str</li> <li>arml</li> <li>armtl</li> <li>mips32b</li> <li>ppc32b</li> <li>x86_32</li> <li>x86_64</li></ul></li> <li>对于windows系统：
<ul><li>x86_64</li> <li>x86_32</li></ul></li></ul></details> <p>使用就如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span>  miasm<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>sandbox <span class="token keyword">import</span> Sandbox_Linux_x86_64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后进行简单设置：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>parser <span class="token operator">=</span> Sandbox_Linux_x86_64<span class="token punctuation">.</span>parser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">&quot;ELF sandboxer&quot;</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&quot;ELF Filename&quot;</span><span class="token punctuation">)</span>
options <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

sb <span class="token operator">=</span> Sandbox_Linux_x86_64<span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

sb<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>首先是获取parser对象， 其作用是处理运行脚本时的命令行参数，然后使用options获取到解析出命令行参数的namespace， 然后设置出sandbox对象，并开始运行即可。</p> <h3 id="数据和内存处理"><a href="#数据和内存处理" class="header-anchor">#</a> 数据和内存处理</h3> <p>主要通过sandbox.jitter， 这是一个jitter对象， 是运行时内置的一个jit engine， 通过这个可以访问和修改正在运行的程序的内存。 相关的函数在python中定义在<code>/miasm/jitter/jitload.py</code>， 基本上全部会转入到jitter.vm对象， 这个对象主要是<code>/miasm/jitter/vm_mngr.c</code>, <code>/miasm/jitter/vm_mngr_py.c</code>中，</p> <p>其中python中定义的<code>jitter.get_c_str</code>和<code>jitter.set_c_str</code>都会转到<code>jitter.vm.get_mem</code>和<code>jitter.vm.set_mem</code>， 这是最常用的四个， 一般用在对libc函数的实现。</p> <p>另外对于内存页等的实现， 有<code>jitter.vm.add_memory_page</code>进行内存页的设置， 一般出现canary的时候从fs[0x28]取值， 将会使用这个处理，不然程序无法访问到fs[0x28]的位置。</p> <h3 id="实现-libc"><a href="#实现-libc" class="header-anchor">#</a> 实现 libc</h3> <div class="custom-block warning"><p class="custom-block-title">warning</p> <p>和angr类似， 这个程序运行在python的miasm框架的环境内，如果他调用了libc函数，都无法找到， 因此我们需要在miasm环境中构造这个函数，在miasm中，我们可以直接在脚本中设置一个对应的函数即可，运行时会自动寻找和调用。</p> <p>目前应该<code>__libc_start_main</code>还有几个不需要，</p> <p>可以直接运行， 看报错提示缺少， 再修复几个，</p></div> <p>在miasm中已经实现了好几个，位置在<code>/miasm/os_dep/linux_stdlib.py</code>， 可以<code>import ×</code>进来， 但是可能也会因为函数名和提取参数啥的不对，</p> <p>这里简单说明几个libc函数的构造，</p> <p>首先传入函数的应该是<code>jitter</code>， 这个我们前面说道的获取字符串或者内存啥的，也基本都是在这里使用的。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> xxx_<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>jitter<span class="token punctuation">)</span>
	ret_ad<span class="token punctuation">,</span> args <span class="token operator">=</span> jitter<span class="token punctuation">.</span>func_args_systemv<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> jitter<span class="token punctuation">.</span>func_ret_systemv<span class="token punctuation">(</span><span class="token punctuation">[</span>ret_ad<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一般一个模拟libc函数应该如上示，</p> <p>关于函数对应的参数和返回值的获取和设置， 中间进行数据处理， 在一般情况下，也并不需要编写非常完备的函数功能， 只要符合当前程序应该运行的状态即可，</p> <div class="custom-block tip"><p class="custom-block-title">tip</p> <p>比如在有些程序里， printf里从没有出现格式化字符串+参数的形式， 那就可以在实现的时候当作一个puts之类的， 简单实现其功能，</p></div> <p>具体的例子可以翻看<code>linux_stdlib.py</code>文件中，或者在实际操作中的脚本，</p> <details class="custom-block details"><summary>details</summary> <p>这里简单例子:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">xxx_fgets</span><span class="token punctuation">(</span>jitter<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token triple-quoted-string string">'''
		原型： char *fgets(char *str, int n, FILE *stream)
		在程序中stream一直为stdin, 因此直接用input了， 
	'''</span>
    ret_ad<span class="token punctuation">,</span> args <span class="token operator">=</span> jitter<span class="token punctuation">.</span>func_args_systemv<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;dest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;size&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stream&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    jitter<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>set_mem<span class="token punctuation">(</span>args<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> jitter<span class="token punctuation">.</span>func_ret_systemv<span class="token punctuation">(</span>ret_ad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">xxx___printf_chk</span><span class="token punctuation">(</span>jitter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    	原型：int printf(const char *format, ...)
    	值得注意的是参数里的's'， 必须加上就正确了， 但是不清楚啥原因。
    '''</span>
    ret_ad<span class="token punctuation">,</span> args <span class="token operator">=</span> jitter<span class="token punctuation">.</span>func_args_systemv<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">&quot;format&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;arg&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>jitter<span class="token punctuation">.</span>get_c_str<span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> jitter<span class="token punctuation">.</span>func_ret_systemv<span class="token punctuation">(</span>ret_ad<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></details> <h3 id="命令行参数"><a href="#命令行参数" class="header-anchor">#</a> 命令行参数</h3> <p>对于程序运行时需要命令行输入的参数，</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>options<span class="token punctuation">.</span>mimic_env <span class="token operator">=</span> Ture
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个变量是在Sandbox_Linux_x86_64对象初始化的时候进行判断，并获取命令行参数，压入栈中。<a href="https://github.com/cea-sec/miasm/blob/master/miasm/analysis/sandbox.py#L641" target="_blank" rel="noopener noreferrer">在这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,</p> <p>然后输入命令行参数：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>options<span class="token punctuation">.</span>command_line <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'....'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="内存段"><a href="#内存段" class="header-anchor">#</a> 内存段</h3> <p>一般使用栈等都不会有太大问题， 但是当程序使用canary时， 将会导致问题， 于是我们要手动设置fs的内存和canary所取的 fs[0x28]位置的数据，</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> miasm<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>csts      <span class="token keyword">import</span> PAGE_READ


sb<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>ir_arch<span class="token punctuation">.</span>do_all_segm <span class="token operator">=</span> <span class="token boolean">True</span>
FS_0_ADDR <span class="token operator">=</span> <span class="token number">0x7ff70000</span>
sb<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>FS <span class="token operator">=</span> <span class="token number">0x4</span>
sb<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>set_segm_base<span class="token punctuation">(</span>sb<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>FS<span class="token punctuation">,</span> FS_0_ADDR<span class="token punctuation">)</span>
sb<span class="token punctuation">.</span>jitter<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>add_memory_page<span class="token punctuation">(</span>FS_0_ADDR <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">,</span> PAGE_READ<span class="token punctuation">,</span> <span class="token string">b&quot;\x42\x42\x42\x42\x42\x42\x42\x42&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Stack canary FS[0x28]&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在<code>miasm.jitter.csts</code>中定义的都是一堆的关于权限控制等常量，</p> <h2 id="dse-技术"><a href="#dse-技术" class="header-anchor">#</a> dse 技术</h2> <p>当我们已经成功可以让程序正常的在miasm环境中运行的时候，可以开始考虑加入dse engine，</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> miasm<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>dse <span class="token keyword">import</span> DSEEngine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="初始化和设置dse"><a href="#初始化和设置dse" class="header-anchor">#</a> 初始化和设置dse</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code>dse <span class="token operator">=</span> DSEEngine<span class="token punctuation">(</span>sb<span class="token punctuation">.</span>machine<span class="token punctuation">)</span>

dse<span class="token punctuation">.</span>add_lib_handler<span class="token punctuation">(</span>sb<span class="token punctuation">.</span>libs<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个dse engine对象定义在<code>/miasm/analysis/dse.py</code>， 初始化传入sandbox内对应的machine属性即可，</p> <p>注意这个<code>dse.add_lib_handler(sb.libs, globals())</code>方法， 作用是载入dse后， 所有的libc函数， 如函数<code>{name}</code>, 设置到对应的<code>{name}_symb</code>函数，如果没有查找到对应的<code>{name}_symb</code>， 则会设置到<a href="https://github.com/cea-sec/miasm/blob/master/miasm/analysis/dse.py#L260" target="_blank" rel="noopener noreferrer"><code>default_func</code>函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 提示这个函数不存在，需要定义。</p> <p>注意这里设置的是handler， 最后<code>add_lib_handler</code>会解析出名字以后调用<code>add_handler</code>设置，</p> <h3 id="dse-attach到jitter"><a href="#dse-attach到jitter" class="header-anchor">#</a> dse attach到jitter</h3> <p>定义好dse对象以后，运行仍然是老样子，要想开始记录符号应该使用:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>dse<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>jitter<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这一句开始我们的dse对象才会投入使用，而且这以后的调用libc都会是调用对应的<code>{name}_symb</code>函数，如果没有定义的话也会开始看到相关报错了。</p> <p>关于这一句的位置，定义好dse以后就可以使用attach，但是一般使用在关键位置附近的libc函数设置一个， 在函数内使用可以加一个<code>global dse</code>。</p> <h3 id="instrumentation和handler相关"><a href="#instrumentation和handler相关" class="header-anchor">#</a> instrumentation和handler相关</h3> <p>设置好dse和attach以后可以开始设置使用instrumentation和handler，这是dse对象内的两个字典：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># /miasm/analysis/dse.py </span>
<span class="token comment"># class DSEEnigne </span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	self<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># addr -&gt; callback(DSEEngine instance)</span>
	self<span class="token punctuation">.</span>instrumentation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment"># addr -&gt; callback(DSEEngine instance)</span>

<span class="token keyword">def</span> <span class="token function">add_handler</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Add a @callback for address @addr before any state update.
    The state IS NOT updated after returning from the callback
    @addr: int
    @callback: func(dse instance)&quot;&quot;&quot;</span>
    self<span class="token punctuation">.</span>handler<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">=</span> callback

<span class="token keyword">def</span> <span class="token function">add_instrumentation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Add a @callback for address @addr before any state update.
    The state IS updated after returning from the callback
    @addr: int
    @callback: func(dse instance)&quot;&quot;&quot;</span>
    self<span class="token punctuation">.</span>instrumentation<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">=</span> callback
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>里面储存的是地址和对应调用的函数，我们可以在脚本中设置好一个函数， 然后使用<code>dse.add_instrumentation</code>或<code>dse.add_handler</code>设置地址和这个函数，</p> <p>这两个字典的使用看起来基本类似，区别是handle不会刷新状态， instrumentation会刷新状态,</p> <div class="custom-block warning"><p class="custom-block-title">warning</p> <p>占坑</p> <p>目前不太清楚这个关于状态刷新的注释啥意思😅 😅😅</p> <p>不过看到相关几个例子， 一般手动设置程序中的某些位置的时候似乎都是使用instrumentation，</p> <p>当然，还有个update_state的方法， 但是看起来并不一样...</p></div> <details class="custom-block details"><summary>details</summary> <p>目前已经看到的， jitter中运行到对应一些位置应该是回去调用dse对象的<a href="https://github.com/cea-sec/miasm/blob/master/miasm/analysis/dse.py#L320" target="_blank" rel="noopener noreferrer">callback函数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，其中代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># /miasm/analysis/dse.py</span>
<span class="token comment"># class DSEEinge</span>
<span class="token comment">#     def callback():</span>
<span class="token keyword">if</span> cur_addr <span class="token keyword">in</span> self<span class="token punctuation">.</span>handler<span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>handler<span class="token punctuation">[</span>cur_addr<span class="token punctuation">]</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">if</span> cur_addr <span class="token keyword">in</span> self<span class="token punctuation">.</span>instrumentation<span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>instrumentation<span class="token punctuation">[</span>cur_addr<span class="token punctuation">]</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这里是关于运行设置好的函数的位置， 因此可以看到我们设置的函数应该参数为dse对象，</p> <p>另外一点就是在handler运行后直接return， 但是对于instrumentation运行后继续运行了后面的部分在最后进行返回，这应该就是两者的差别位置，也是关于状态刷新之类的。</p></details> <h3 id="符号化-和-状态刷新"><a href="#符号化-和-状态刷新" class="header-anchor">#</a> 符号化 和 状态刷新</h3> <p>类似z3中设置符号的方式， miasm中使用<code>Expr</code>系列的对象，是miasm中的ir中间语言的表示，</p> <p>一般这样一个对象表示一个符号化的变量，通过<code>dse.update_state()</code>方法插入到程序中，通过<code>dse.eval_expr()</code>方法获取输入后的已经记录了运算的一个带符号表达式，</p> <p>注意在插入所有符号前， 应该在attach以后，使用<code>dse.update_state_from_concrete()</code>， 从原本的由确定值运行的环境中载入到dse环境。</p> <div class="custom-block tip"><p class="custom-block-title">tip</p> <p>最简单的一个示例是miasm-blog中的tigress0-challenge0的处理，在文章<a href="https://miasm.re/blog/2017/10/05/playing_with_dynamic_symbolic_execution.html" target="_blank" rel="noopener noreferrer">Playing with Dynamic symbolic execution<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>我下一步也将会在博客的wp区, tigress0-0中写上对应的wp</p></div> <div class="language-python line-numbers-mode"><pre class="language-python"><code>dse<span class="token punctuation">.</span>update_state_from_concrete<span class="token punctuation">(</span><span class="token punctuation">)</span>
dse<span class="token punctuation">.</span>update_state<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

dse<span class="token punctuation">.</span>exal_expr<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="获取和设置寄存器"><a href="#获取和设置寄存器" class="header-anchor">#</a> 获取和设置寄存器</h3> <p>在加入dse以后，环境中一共存在两套数据， 一个是原本的具体值， 一个是符号化的数据。</p> <p>具体值，通过<code>dse.jitter.cpu.xx</code>访问寄存器， 或者<code>sb.jitter.cpu.xx</code>这两个是等同的。 返回值是一个int类型，可以直接获取。赋值直接使用<code>=</code>即可。</p> <p>符号值， 通过<code>1dse.ir_arch.arch.regs.xx</code>访问寄存器，赋值通过<code>dse.update({..: ..})</code>赋值进去一个符号值。获取通过<code>dse.eval_expr(xx)</code>， 即可获取对应带符号的表达式。</p> <h2 id="bug"><a href="#bug" class="header-anchor">#</a> bug</h2> <p>学习过程中发现的代码上的问题， 主要是错误回显信息没更新导致有几个小问题，</p> <p>不过也不一定修没修， 这个框架更新还是比较频繁的，</p> <h3 id="get-str-ansi"><a href="#get-str-ansi" class="header-anchor">#</a> get_str_ansi</h3> <p>首先是<code>jitter.get_str_ansi(args.nptr)</code>这个函数已经不再支持， 调用将会报错， 提示去使用另一个函数，源码中如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># miasm/jitter/jitload.py</span>
<span class="token keyword">def</span> <span class="token function">get_str_ansi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> max_char<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">&quot;Deprecated: use os_dep.win_api_x86_32.get_win_str_a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>但是我们会发现，在<code>miasm/os_dep/win_api_x86_32.py</code>中并没有这个函数， 他已经被转移到了<code>miasm/os_dep/common.py</code>中， 源码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># miasm/os_dep/common.py</span>
<span class="token keyword">def</span> <span class="token function">get_win_str_a</span><span class="token punctuation">(</span>jitter<span class="token punctuation">,</span> ad_str<span class="token punctuation">,</span> max_char<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因此这个调用应该修改为：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> miasm<span class="token punctuation">.</span>os_dep<span class="token punctuation">.</span>common  <span class="token keyword">import</span> get_win_str_a

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
content <span class="token operator">=</span> get_win_str_a<span class="token punctuation">(</span>jitter<span class="token punctuation">,</span> args<span class="token punctuation">.</span>nptr<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>同样的get_str_unic函数也是一样：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># miasm/jitter/jitload.py</span>
<span class="token keyword">def</span> <span class="token function">get_str_unic</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> max_char<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">&quot;Deprecated: use os_dep.win_api_x86_32.get_win_str_a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=miasm" title="标签">#miasm</a><a href="/tags/?tag=dse" title="标签">#dse</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/24/2021, 2:44:29 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:wl200103124@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wlingze" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://blog.csdn.net/wlz_lc_4" title="csdn" target="_blank" class="iconfont icon-csdn"></a><a href="https://www.zhihu.com/people/wlingze" title="zhihu" target="_blank" class="iconfont icon-zhihu"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>lingze | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.01f8cc77.js" defer></script><script src="/assets/js/2.5ece5099.js" defer></script><script src="/assets/js/19.2d69c943.js" defer></script>
  </body>
</html>
