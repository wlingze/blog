(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{541:function(t,s,a){"use strict";a.r(s);var n=a(31),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"从一个reverse-box到python脚本化调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从一个reverse-box到python脚本化调试"}},[t._v("#")]),t._v(" 从一个reverse-box到python脚本化调试")]),t._v(" "),a("p",[t._v("@[toc]")]),t._v(" "),a("blockquote",[a("p",[t._v("攻防世界 reverse-box 题目")]),t._v(" "),a("p",[t._v("原题来自  "),a("a",{attrs:{href:"https://github.com/ctfs/write-ups-2016/tree/master/mma-ctf-2nd-2016/reverse/reverse-box-50",target:"_blank",rel:"noopener noreferrer"}},[t._v("mma-ctf-2nd-2016: reverse-box"),a("OutboundLink")],1)])]),t._v(" "),a("h1",{attrs:{id:"题目分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#题目分析"}},[t._v("#")]),t._v(" 题目分析")]),t._v(" "),a("h2",{attrs:{id:"题目条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#题目条件"}},[t._v("#")]),t._v(" 题目条件")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("Description:")])])]),t._v(" "),a("p",[t._v("$ ./reverse_box ${FLAG}")]),t._v(" "),a("p",[t._v("95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a")]),t._v(" "),a("p",[t._v("题目flag格式：TWCTF{..}")]),t._v(" "),a("h2",{attrs:{id:"分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[t._v("#")]),t._v(" 分析")]),t._v(" "),a("p",[t._v("main函数如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110455857.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsel9sY180,size_16,color_FFFFFF,t_70",alt:""}})]),t._v(" "),a("p",[t._v("运行程序时输入的参数，会和一个数值相加，转化成十六进制，然后打印出来，")]),t._v(" "),a("p",[t._v("我们简单运行下如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110504408.png",alt:""}})]),t._v(" "),a("p",[t._v("另外汇编是：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110513492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dsel9sY180,size_16,color_FFFFFF,t_70",alt:""}})]),t._v(" "),a("p",[t._v("这个位置，是一个查表的过程，函数"),a("code",[t._v("sub_804858D")]),t._v("是一个建立表的过程，")]),t._v(" "),a("p",[t._v("重点在于：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110525648.png",alt:""}}),t._v("\n后部分都是设置建立表，但是这个生成表的种子是随机的，也就是我们的表是不固定的。\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110532836.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[t._v("#")]),t._v(" 思路")]),t._v(" "),a("p",[t._v("题目就是对输入进行查表，然后打印出来，并且给出了正确flag查表对应的值，但是这个表是随机生成的，我们需要得到正确的一个表。")]),t._v(" "),a("p",[t._v("方案应该是只能爆破，并且"),a("code",[t._v("rand()")]),t._v("函数调用的返回值，限制为"),a("code",[t._v("int8")]),t._v("即0xff大小，最大为0xff，爆破次数不算太大，直接爆破出来正确的表，就结束了。")]),t._v(" "),a("p",[t._v("这时候我们面对一个问题，这个怎么方便的进行爆破？")]),t._v(" "),a("p",[t._v("下面我们写一下关于爆破的方法，")]),t._v(" "),a("blockquote",[a("p",[t._v("其中ｗｐ有的直接爆破出正确的，有的直接爆破出所有的再交python得到最后工作，这都是差不多的， 我们只讨论爆破的实现。")])]),t._v(" "),a("p",[t._v("下面是我搜到一些ｗｐ中的解法：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/ByteBandits/writeups/tree/master/mma-ctf-2016/re/reverse-box/sudhackar",target:"_blank",rel:"noopener noreferrer"}},[t._v("gdb 脚本--github"),a("OutboundLink")],1),a("a",{attrs:{href:"https://blog.csdn.net/qq_38025365/article/details/89577302",target:"_blank",rel:"noopener noreferrer"}},[t._v("gdb脚本-csdn"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("[gdb - python 脚本](https://github.com/TeamContagion/CTF-Write-Ups/tree/master/TokyoWesterns-2016/Reverse Box))")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ispoleet/ctf-writeups/tree/master/mma_ctf_2016/reverse_box",target:"_blank",rel:"noopener noreferrer"}},[t._v("idc脚本"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blahcat.github.io/2016/09/06/twctf-2016-reverse-box-writeup/",target:"_blank",rel:"noopener noreferrer"}},[t._v("uncorn 脚本"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://qy.sg/tokyo-westerns-ctf-2nd-2016-reverse-box/",target:"_blank",rel:"noopener noreferrer"}},[t._v("python 重构这个函数然后爆破"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("[ida-python脚本]　(本文)")])]),t._v(" "),a("p",[t._v("其中大部分方法都可以看到链接。一个ida python的手段是我们的重点，　也恰好是在wp没有看到的一种方案。")]),t._v(" "),a("h2",{attrs:{id:"ida-python爆破"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ida-python爆破"}},[t._v("#")]),t._v(" ida-python爆破")]),t._v(" "),a("p",[t._v("相关的文章是"),a("a",{attrs:{href:"https://wizardforcel.gitbooks.io/grey-hat-python/content/43.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个"),a("OutboundLink")],1),t._v("，　比较详细的介绍了相关的函数。")]),t._v(" "),a("p",[t._v("脚本：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" idaapi\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" idc\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n\tRunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x080485b1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" i\n\tSetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eax"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tRunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x08048704")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eax"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tRunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x08048746")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tSetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x080486D4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x95")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" i \n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\nRunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x080485b1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" i\nSetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eax"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nRunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x08048704")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"esp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\narr_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x1c")]),t._v("\narr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\tarr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Byte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'95eeaf95ef94234999582f722f492f72b19a7aaf72e6e776b57aee722fe77ab5ad9aaeb156729676ae7a236d99b1df4a'")]),t._v("\na "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\ta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("chr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br")])]),a("p",[t._v("注意idc定义的的函数可以直接在ida-python中调用。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意一点："),a("a",{attrs:{href:"https://reverseengineering.stackexchange.com/questions/11601/how-can-i-step-through-instructions-in-ida-and-know-the-current-eip",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于"),a("code",[t._v("GetDebuggerEvent()")]),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("这个代码看起来很无用，但是不加会报错，")]),t._v(" "),a("p",[t._v("因为python脚本和调试器会异步执行，我们要获取寄存器的话应该要等待，直接过去是会报错，显示寄存器名错误，可以通过加入"),a("code",[t._v("GetDebuggerEvent(WFNE_SUSP, -1)")]),t._v("来解决这个问题，")]),t._v(" "),a("p",[t._v("注意每次要读取修改数据啥的要加一个这个就可以了。")])]),t._v(" "),a("p",[t._v("设置好debug  options， 直接运行脚本，ida会自动开始动调，")]),t._v(" "),a("p",[t._v("然后运行脚本得到flag，")]),t._v(" "),a("blockquote",[a("p",[t._v("ida 内运行直接得到flag\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20200407110548547.png",alt:""}})])]),t._v(" "),a("h2",{attrs:{id:"另外"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#另外"}},[t._v("#")]),t._v(" 另外")]),t._v(" "),a("p",[t._v("注意两点，")]),t._v(" "),a("ul",[a("li",[t._v("参数")])]),t._v(" "),a("p",[t._v("一个是对于这种要求调用时要参数的程序，我们在ida  debug  options中设置：")]),t._v(" "),a("p",[t._v("[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AZwpjfBD-1586228644870)(image-20200405222503984.png)]")]),t._v(" "),a("p",[t._v('这样调试的时候，对应的参数就是"T"')]),t._v(" "),a("blockquote",[a("p",[t._v("这个是linux 下wine运行的ida因此为127.0.0.1")])]),t._v(" "),a("ul",[a("li",[t._v("ida-python 调试不能自己重复多次调试")])]),t._v(" "),a("p",[t._v("我们的脚本的循环中每次都是改掉eip调整程序运行的。ida-python 不能够自动循环启动多次调试，但是对于一般题目修改eip已经足够我们的使用。")]),t._v(" "),a("h1",{attrs:{id:"动调脚本化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动调脚本化"}},[t._v("#")]),t._v(" 动调脚本化")]),t._v(" "),a("p",[t._v("在所有的ｗｐ解法中，　我认为最简洁和具有通用性的应该是ida-python的解法和gdb-python的解法，")]),t._v(" "),a("p",[t._v("这里简单写一下相关的使用。")]),t._v(" "),a("p",[t._v("gdb - python, "),a("a",{attrs:{href:"https://sourceware.org/gdb/current/onlinedocs/gdb/Python-API.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("有一个官方文档"),a("OutboundLink")],1),t._v(", 然后个人觉得使用起来略显复杂，主要写下idapython")]),t._v(" "),a("h2",{attrs:{id:"ida-python"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ida-python"}},[t._v("#")]),t._v(" ida - python")]),t._v(" "),a("p",[t._v("然后在动调主要使用到的函数：")]),t._v(" "),a("p",[a("code",[t._v("AddBpt(long Address)")]),t._v(":　在指定的地址设置断点")]),t._v(" "),a("p",[a("code",[t._v("GetRegValue(string Register)")]),t._v("：获取一个寄存器的名称")]),t._v(" "),a("p",[a("code",[t._v("SetRegValue(long Value, string Register)")]),t._v("设置寄存器的值")]),t._v(" "),a("p",[a("code",[t._v("RunTo(long Address)")]),t._v("： 运行到指定的地址，然后停下。")]),t._v(" "),a("p",[a("code",[t._v("GetDebuggerEvnt(WFNE_SUSP, -1)")]),t._v("：应该是获取调试某一过程中信息，一般就在"),a("code",[t._v("RunTo()")]),t._v("后和操作寄存器前使用，"),a("a",{attrs:{href:"https://reverseengineering.stackexchange.com/questions/11601/how-can-i-step-through-instructions-in-ida-and-know-the-current-eip",target:"_blank",rel:"noopener noreferrer"}},[t._v("解决脚本和调试异步而导致的寄存器读取报错的问题"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("一般使用的：")]),t._v(" "),a("ul",[a("li",[t._v("用于程序运行， 获取相关位置，设定相关寄存器。")])]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("RunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\nxxx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[t._v("获取栈内数据：")])]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("RunTo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nGetDebuggerEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WFNE_SUSP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GetRegValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"esp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("这样，运行到某个位置，获取esp/rsp的值，为栈顶，通过偏移可以获取相对应的栈内地址，然后使用"),a("code",[t._v("Byte()")]),t._v("/ "),a("code",[t._v("Dword()")]),t._v("来获取相关数据，如果需要的话我们还可以通过"),a("code",[t._v("PatchByte(long Addr, byte)")]),t._v("来进行数据的修改，")])])}),[],!1,null,null,null);s.default=e.exports}}]);